<div class="page-container">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="loader">
      <div class="wave"></div>
      <div class="wave"></div>
      <div class="wave"></div>
      <div class="wave"></div>
      <div class="wave"></div>
    </div>
    <p class="loading-text">Loading releases from artists you follow...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !loading">
    <svg
      width="48"
      height="48"
      viewBox="0 0 24 24"
      fill="none"
      stroke="#ff4757"
      stroke-width="2"
    >
      <circle cx="12" cy="12" r="10" />
      <line x1="12" y1="8" x2="12" y2="12" />
      <line x1="12" y1="16" x2="12.01" y2="16" />
    </svg>
    <p class="error-text">{{ error }}</p>
    <button class="retry-btn" (click)="loadReleases(true)">Try Again</button>
  </div>

  <!-- Main Content -->
  <div class="content" *ngIf="!loading && !error">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"
          />
        </svg>
        Release Calendar
      </h1>
      <p class="page-subtitle">New music from artists you follow</p>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-card">
        <span class="stat-value">{{ totalReleases }}</span>
        <span class="stat-label">Total Releases</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ albumCount }}</span>
        <span class="stat-label">Albums</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ singleCount }}</span>
        <span class="stat-label">Singles</span>
      </div>
      <div class="stat-card highlight">
        <span class="stat-value">{{ upcomingCount }}</span>
        <span class="stat-label">Upcoming</span>
      </div>
    </div>

    <!-- Controls Bar -->
    <div class="controls-bar">
      <div class="view-toggle">
        <button
          [class.active]="viewMode === 'calendar'"
          (click)="setViewMode('calendar')"
          title="Calendar view"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"
            />
          </svg>
        </button>
        <button
          [class.active]="viewMode === 'list'"
          (click)="setViewMode('list')"
          title="List view"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"
            />
          </svg>
        </button>
      </div>

      <div class="filter-toggle">
        <button
          [class.active]="filterType === 'all'"
          (click)="setFilterType('all')"
        >
          All
        </button>
        <button
          [class.active]="filterType === 'album'"
          (click)="setFilterType('album')"
        >
          Albums
        </button>
        <button
          [class.active]="filterType === 'single'"
          (click)="setFilterType('single')"
        >
          Singles
        </button>
      </div>

      <button class="refresh-btn" (click)="refresh()" title="Refresh releases">
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M23 4v6h-6M1 20v-6h6" />
          <path
            d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"
          />
        </svg>
      </button>
    </div>

    <!-- Calendar View -->
    <div class="calendar-view" *ngIf="viewMode === 'calendar'">
      <!-- Month Navigation -->
      <div class="month-nav">
        <button class="nav-btn" (click)="previousMonth()">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M15 18l-6-6 6-6" />
          </svg>
        </button>
        <div class="month-title">
          <h2>{{ getMonthName() }}</h2>
          <button class="today-btn" (click)="goToToday()">Today</button>
        </div>
        <button class="nav-btn" (click)="nextMonth()">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M9 18l6-6-6-6" />
          </svg>
        </button>
      </div>

      <!-- Week Headers -->
      <div class="week-headers">
        <div class="week-day" *ngFor="let day of weekDays">{{ day }}</div>
      </div>

      <!-- Calendar Grid -->
      <div class="calendar-grid">
        <div
          class="calendar-day"
          *ngFor="let day of calendarDays"
          [class.other-month]="!day.isCurrentMonth"
          [class.today]="day.isToday"
          [class.has-releases]="day.releases.length > 0"
          [class.selected]="selectedDay === day"
          (click)="selectDay(day)"
        >
          <span class="day-number">{{ day.dayOfMonth }}</span>

          <div class="release-dots" *ngIf="day.releases.length > 0">
            <span
              class="dot"
              *ngFor="let release of day.releases.slice(0, 3)"
              [class.album]="release.album_type === 'album'"
              [class.single]="release.album_type === 'single'"
            ></span>
            <span class="more-dot" *ngIf="day.releases.length > 3"
              >+{{ day.releases.length - 3 }}</span
            >
          </div>

          <!-- Preview on hover (desktop) -->
          <div class="release-preview" *ngIf="day.releases.length > 0">
            <div
              class="preview-item"
              *ngFor="let release of day.releases.slice(0, 2)"
              (click)="goToAlbum(release.id); $event.stopPropagation()"
            >
              <img
                [src]="release.images?.[2]?.url || release.images?.[0]?.url || 'assets/default-album.png'"
                [alt]="release.name"
              />
              <div class="preview-info">
                <span class="preview-name">{{ release.name }}</span>
                <span
                  class="preview-artist"
                  >{{ release.artists?.[0]?.name }}</span
                >
              </div>
            </div>
            <div class="preview-more" *ngIf="day.releases.length > 2">
              +{{ day.releases.length - 2 }} more
            </div>
          </div>
        </div>
      </div>

      <!-- Selected Day Detail -->
      <div
        class="day-detail"
        *ngIf="selectedDay && selectedDay.releases.length > 0"
      >
        <div class="detail-header">
          <h3>{{ formatDate(selectedDay.date) }}</h3>
          <span class="release-count"
            >{{ selectedDay.releases.length }} release{{
              selectedDay.releases.length !== 1 ? "s" : ""
            }}</span
          >
        </div>

        <div class="detail-releases">
          <div
            class="release-item"
            *ngFor="let release of selectedDay.releases"
            (click)="goToAlbum(release.id)"
          >
            <img
              class="release-image"
              [src]="release.images?.[1]?.url || release.images?.[0]?.url || 'assets/default-album.png'"
              [alt]="release.name"
            />
            <div class="release-info">
              <h4 class="release-name">{{ release.name }}</h4>
              <p class="release-artist">
                <a
                  (click)="goToArtist(release.artists?.[0]?.id, $event)"
                  >{{ release.artists?.[0]?.name }}</a
                >
              </p>
              <div class="release-meta">
                <span
                  class="type-badge"
                  [class.album]="release.album_type === 'album'"
                  [class.single]="release.album_type === 'single'"
                >
                  {{ release.album_type === "single" ? "Single" : "Album" }}
                </span>
                <span class="track-count"
                  >{{ release.total_tracks }}
                  {{ release.total_tracks === 1 ? "track" : "tracks" }}</span
                >
              </div>
            </div>
            <button
              class="spotify-btn"
              (click)="openInSpotify(release.external_urls?.spotify, $event)"
              title="Open in Spotify"
            >
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- List View -->
    <div class="list-view" *ngIf="viewMode === 'list'">
      <div class="releases-grid">
        <div
          class="release-card"
          *ngFor="let release of filteredReleases"
          (click)="goToAlbum(release.id)"
        >
          <div class="card-image">
            <img
              [src]="release.images?.[1]?.url || release.images?.[0]?.url || 'assets/default-album.png'"
              [alt]="release.name"
            />
            <div class="card-overlay">
              <svg
                width="40"
                height="40"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M8 5v14l11-7z" />
              </svg>
            </div>
            <span
              class="type-badge"
              [class.album]="release.album_type === 'album'"
              [class.single]="release.album_type === 'single'"
            >
              {{ release.album_type === "single" ? "Single" : "Album" }}
            </span>
            <span
              class="date-badge"
              [class.upcoming]="isUpcoming(release.releaseDate)"
            >
              {{ getRelativeDate(release) }}
            </span>
          </div>
          <div class="card-info">
            <h3 class="release-name">{{ release.name }}</h3>
            <p class="release-artist">
              <a
                (click)="goToArtist(release.artists?.[0]?.id, $event)"
                >{{ release.artists?.[0]?.name }}</a
              >
            </p>
            <div class="release-meta">
              <span class="release-date">{{
                formatReleaseDate(release.release_date)
              }}</span>
              <span class="track-count"
                >{{ release.total_tracks }}
                {{ release.total_tracks === 1 ? "track" : "tracks" }}</span
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredReleases.length === 0">
      <div class="empty-icon">
        <svg
          width="64"
          height="64"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path
            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"
          />
        </svg>
      </div>
      <h3>No Releases Found</h3>
      <p>Follow more artists to see their latest releases here!</p>
    </div>
  </div>
</div>
