<div class="page-container">
  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loader-content">
      <div class="progress-ring">
        <svg viewBox="0 0 100 100">
          <circle class="bg" cx="50" cy="50" r="45"/>
          <circle 
            class="progress" 
            cx="50" cy="50" r="45"
            [style.strokeDashoffset]="283 - (283 * loadingProgress / 100)"
          />
        </svg>
        <span class="progress-text">{{ loadingProgress }}%</span>
      </div>
      <p class="loading-message">{{ loadingMessage }}</p>
    </div>
  </div>

  <div class="calendar-content" *ngIf="!loading">
    <!-- Page Header -->
    <header class="page-header">
      <button class="back-btn" routerLink="/my-profile">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
        Back to Profile
      </button>
      <h1 class="page-title">Release Calendar</h1>
      <p class="page-subtitle">New music from artists you follow</p>
    </header>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-card">
        <span class="stat-value">{{ totalReleases }}</span>
        <span class="stat-label">Total Releases</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ albumCount }}</span>
        <span class="stat-label">Albums</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ singleCount }}</span>
        <span class="stat-label">Singles</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ artistsWithReleases }}</span>
        <span class="stat-label">Artists</span>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls-bar">
      <div class="view-toggle">
        <button 
          [class.active]="viewMode === 'calendar'" 
          (click)="setViewMode('calendar')"
        >
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          Calendar
        </button>
        <button 
          [class.active]="viewMode === 'list'" 
          (click)="setViewMode('list')"
        >
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"/>
            <line x1="8" y1="12" x2="21" y2="12"/>
            <line x1="8" y1="18" x2="21" y2="18"/>
            <line x1="3" y1="6" x2="3.01" y2="6"/>
            <line x1="3" y1="12" x2="3.01" y2="12"/>
            <line x1="3" y1="18" x2="3.01" y2="18"/>
          </svg>
          List
        </button>
      </div>

      <div class="filter-toggle">
        <button 
          [class.active]="filterType === 'all'" 
          (click)="setFilterType('all')"
        >All</button>
        <button 
          [class.active]="filterType === 'album'" 
          (click)="setFilterType('album')"
        >Albums</button>
        <button 
          [class.active]="filterType === 'single'" 
          (click)="setFilterType('single')"
        >Singles</button>
      </div>
    </div>

    <!-- Calendar View -->
    <div class="calendar-view" *ngIf="viewMode === 'calendar'">
      <!-- Month Navigation -->
      <div class="month-nav">
        <button class="nav-btn" (click)="previousMonth()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <div class="month-title">
          <h2>{{ getMonthName() }}</h2>
          <button class="today-btn" (click)="goToToday()">Today</button>
        </div>
        <button class="nav-btn" (click)="nextMonth()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>

      <!-- Week Headers -->
      <div class="week-headers">
        <div class="week-day" *ngFor="let day of weekDays">{{ day }}</div>
      </div>

      <!-- Calendar Grid -->
      <div class="calendar-grid">
        <div 
          class="calendar-day"
          *ngFor="let day of calendarDays"
          [class.other-month]="!day.isCurrentMonth"
          [class.today]="day.isToday"
          [class.has-releases]="day.releases.length > 0"
          [class.selected]="selectedDay === day"
          (click)="selectDay(day)"
        >
          <span class="day-number">{{ day.dayOfMonth }}</span>
          
          <div class="release-dots" *ngIf="day.releases.length > 0">
            <ng-container *ngFor="let release of day.releases; let i = index">
              <span 
                *ngIf="i < 3"
                class="dot" 
                [class.album]="release.type === 'album'"
                [class.single]="release.type === 'single'"
              ></span>
            </ng-container>
            <span class="more-dot" *ngIf="day.releases.length > 3">+{{ day.releases.length - 3 }}</span>
          </div>
          
          <!-- Preview on hover (desktop) -->
          <div class="release-preview" *ngIf="day.releases.length > 0">
            <ng-container *ngFor="let release of day.releases; let i = index">
              <div class="preview-item" *ngIf="i < 2">
                <img [src]="release.images[2]?.url || release.images[0]?.url" [alt]="release.name"/>
                <div class="preview-info">
                  <span class="preview-name">{{ release.name }}</span>
                  <span class="preview-artist">{{ release.artist.name }}</span>
                </div>
              </div>
            </ng-container>
            <div class="preview-more" *ngIf="day.releases.length > 2">
              +{{ day.releases.length - 2 }} more
            </div>
          </div>
        </div>
      </div>

      <!-- Selected Day Detail -->
      <div class="day-detail" *ngIf="selectedDay && selectedDay.releases.length > 0">
        <div class="detail-header">
          <h3>{{ formatDate(selectedDay.date) }}</h3>
          <span class="release-count">{{ selectedDay.releases.length }} release{{ selectedDay.releases.length !== 1 ? 's' : '' }}</span>
          <button class="close-btn" (click)="clearSelectedDay()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        
        <div class="releases-list">
          <div 
            class="release-item" 
            *ngFor="let release of selectedDay.releases"
            (click)="goToArtist(release.artist.id)"
          >
            <div class="release-image">
              <img [src]="release.images[1]?.url || release.images[0]?.url" [alt]="release.name"/>
              <span class="type-badge" [class.album]="release.type === 'album'">
                {{ release.type }}
              </span>
            </div>
            <div class="release-info">
              <h4 class="release-name">{{ release.name }}</h4>
              <p class="release-artist">{{ release.artist.name }}</p>
              <span class="track-count">{{ release.totalTracks }} track{{ release.totalTracks !== 1 ? 's' : '' }}</span>
            </div>
            <button class="spotify-btn" (click)="openInSpotify(release.spotifyUrl, $event)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- List View -->
    <div class="list-view" *ngIf="viewMode === 'list'">
      <div class="list-section upcoming" *ngIf="getFilteredReleases().length > 0">
        <h3 class="section-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          Upcoming &amp; Recent
        </h3>
        
        <div class="releases-grid">
          <div 
            class="release-card"
            *ngFor="let release of getFilteredReleases()"
            (click)="goToArtist(release.artist.id)"
          >
            <div class="card-image">
              <img [src]="release.images[1]?.url || release.images[0]?.url" [alt]="release.name"/>
              <div class="card-overlay">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 5v14l11-7z"/>
                </svg>
              </div>
              <span class="type-badge" [class.album]="release.type === 'album'">
                {{ release.type }}
              </span>
              <span class="date-badge" [class.upcoming]="isUpcoming(release.releaseDate)">
                {{ getRelativeDate(release.releaseDate) }}
              </span>
            </div>
            
            <div class="card-content">
              <h4 class="release-name">{{ release.name }}</h4>
              <div class="artist-row">
                <img 
                  *ngIf="release.artist.image" 
                  [src]="release.artist.image" 
                  [alt]="release.artist.name"
                  class="artist-avatar"
                />
                <span class="artist-name">{{ release.artist.name }}</span>
              </div>
              <div class="meta-row">
                <span class="release-date">{{ release.releaseDateStr }}</span>
                <span class="track-count">{{ release.totalTracks }} tracks</span>
              </div>
            </div>
            
            <button class="spotify-btn" (click)="openInSpotify(release.spotifyUrl, $event)">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
              </svg>
              Open
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="getFilteredReleases().length === 0">
        <div class="empty-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </div>
        <h3>No releases found</h3>
        <p *ngIf="filterType !== 'all'">Try changing the filter to see more releases</p>
        <p *ngIf="filterType === 'all'">Follow more artists to see their releases here</p>
      </div>
    </div>
  </div>
</div>
