<div class="page-container">
  <app-loader
    [loading]="loading"
    message="Loading your playlists..."
  ></app-loader>

  <div class="playlists-content" *ngIf="!loading">
    <!-- Page Header -->
    <header class="page-header">
      <button class="back-btn" routerLink="/my-profile">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M15 18l-6-6 6-6" />
        </svg>
        Back to Profile
      </button>
      <h1 class="page-title">My Playlists</h1>
      <p class="page-subtitle">Your Spotify playlists</p>
    </header>

    <!-- Search & Filter -->
    <div class="controls-bar">
      <div class="search-box">
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="11" cy="11" r="8" />
          <path d="m21 21-4.35-4.35" />
        </svg>
        <input
          type="text"
          placeholder="Search playlists..."
          [(ngModel)]="searchQuery"
          (input)="filterPlaylists()"
        />
        <button class="clear-btn" *ngIf="searchQuery" (click)="clearSearch()">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>

      <div class="sort-dropdown">
        <select [(ngModel)]="sortBy" (change)="sortPlaylists()">
          <option value="name">Name A-Z</option>
          <option value="name-desc">Name Z-A</option>
          <option value="tracks">Most Tracks</option>
          <option value="recent">Recently Added</option>
        </select>
      </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <span class="total-count">
        <strong>{{ filteredPlaylists.length }}</strong>
        {{ filteredPlaylists.length === 1 ? "playlist" : "playlists" }}
        <span *ngIf="searchQuery"> matching "{{ searchQuery }}"</span>
      </span>
    </div>

    <!-- Playlists Grid -->
    <div class="playlists-grid" *ngIf="filteredPlaylists.length > 0">
      <div
        class="playlist-card"
        *ngFor="let playlist of filteredPlaylists"
        (click)="goToPlaylist(playlist.id)"
      >
        <div class="playlist-image-wrapper">
          <img
            [src]="playlist.images?.[0]?.url || 'assets/default-playlist.png'"
            [alt]="playlist.name"
            class="playlist-image"
          />
          <div class="image-overlay">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z" />
            </svg>
          </div>
          <div class="owner-badge" *ngIf="playlist.owner?.id === userId">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
              />
            </svg>
            Yours
          </div>
        </div>

        <div class="playlist-info">
          <h3 class="playlist-name">{{ playlist.name }}</h3>
          <p class="playlist-description" *ngIf="playlist.description">
            {{ playlist.description | slice : 0 : 60
            }}{{ playlist.description.length > 60 ? "..." : "" }}
          </p>
          <div class="playlist-meta">
            <span class="track-count">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"
                />
              </svg>
              {{ playlist.tracks?.total || 0 }} tracks
            </span>
            <span class="playlist-visibility">
              {{ playlist.public ? "Public" : "Private" }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredPlaylists.length === 0 && !loading">
      <div class="empty-icon">
        <svg
          width="64"
          height="64"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path d="M9 18V5l12-2v13" />
          <circle cx="6" cy="18" r="3" />
          <circle cx="18" cy="16" r="3" />
        </svg>
      </div>
      <h3 *ngIf="searchQuery">No playlists found</h3>
      <h3 *ngIf="!searchQuery">No playlists yet</h3>
      <p *ngIf="searchQuery">Try a different search term</p>
      <p *ngIf="!searchQuery">Create playlists on Spotify to see them here</p>
    </div>
  </div>
</div>
