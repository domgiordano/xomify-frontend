<div class="modal-backdrop" (click)="onBackdropClick($event)">
  <div class="modal-content">
    <!-- Close Button -->
    <button class="close-btn" (click)="close()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>

    <!-- Title -->
    <h2 class="modal-title">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
      </svg>
      Add Song
    </h2>

    <!-- Tab Toggle -->
    <div class="tab-toggle">
      <button
        class="tab-btn"
        [class.active]="activeTab === 'paste'"
        (click)="switchTab('paste')"
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
          <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
        </svg>
        Paste Link
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'search'"
        (click)="switchTab('search')"
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        Search
      </button>
    </div>

    <!-- Paste Link Tab -->
    <div class="tab-content" *ngIf="activeTab === 'paste'">
      <div class="url-input-container">
        <svg class="spotify-icon" width="20" height="20" viewBox="0 0 24 24" fill="#1db954">
          <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
        </svg>
        <input
          type="text"
          class="url-input"
          placeholder="Paste Spotify song link..."
          [(ngModel)]="spotifyUrl"
          (input)="onUrlInput()"
        />
        <button class="clear-btn" *ngIf="spotifyUrl" (click)="clearUrl()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <!-- URL Error -->
      <div class="url-error" *ngIf="urlError">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        {{ urlError }}
      </div>

      <!-- URL Loading -->
      <div class="url-loading" *ngIf="urlLoading">
        <div class="mini-loader"></div>
        <span>Fetching track details...</span>
      </div>

      <!-- Track Preview (from URL) -->
      <div class="track-preview" *ngIf="parsedTrack">
        <img [src]="getAlbumArt(parsedTrack)" class="track-image" />
        <div class="track-info">
          <h4 class="track-name">{{ parsedTrack.name }}</h4>
          <p class="track-artist">{{ getArtistNames(parsedTrack) }}</p>
          <span class="track-duration">{{ formatDuration(parsedTrack.duration_ms) }}</span>
        </div>
        <div class="track-selected">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg>
        </div>
      </div>
    </div>

    <!-- Search Tab -->
    <div class="tab-content" *ngIf="activeTab === 'search'">
      <div class="search-input-container">
        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input
          type="text"
          class="search-input"
          placeholder="Search for songs..."
          [(ngModel)]="searchQuery"
          (input)="onSearchInput()"
        />
        <button class="clear-btn" *ngIf="searchQuery" (click)="clearSearch()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <!-- Search Loading -->
      <div class="search-loading" *ngIf="searchLoading">
        <div class="mini-loader"></div>
        <span>Searching...</span>
      </div>

      <!-- Search Results -->
      <div class="search-results" *ngIf="!searchLoading && searchResults.length > 0">
        <div
          class="result-item"
          *ngFor="let track of searchResults"
          [class.selected]="selectedTrack?.id === track.id"
          (click)="selectTrack(track)"
        >
          <img [src]="getAlbumArt(track)" class="result-image" />
          <div class="result-info">
            <h4 class="result-name">{{ track.name }}</h4>
            <p class="result-artist">{{ getArtistNames(track) }}</p>
          </div>
          <span class="result-duration">{{ formatDuration(track.duration_ms) }}</span>
          <div class="result-selected" *ngIf="selectedTrack?.id === track.id">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- No Results -->
      <div class="no-results" *ngIf="!searchLoading && searchQuery.length >= 2 && searchResults.length === 0">
        <p>No songs found for "{{ searchQuery }}"</p>
      </div>

      <!-- Search Hint -->
      <div class="search-hint" *ngIf="!searchLoading && searchQuery.length < 2 && searchResults.length === 0">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <p>Type to search for songs</p>
      </div>
    </div>

    <!-- Add Button -->
    <button
      class="add-btn"
      [disabled]="!canAddSong()"
      (click)="addSong()"
    >
      <span *ngIf="!addingTrack">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
        Add to Group
      </span>
      <div class="spinner" *ngIf="addingTrack"></div>
    </button>
  </div>
</div>
